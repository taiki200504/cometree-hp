# UNION HP 開発計画（全体版）

**方針**: すべてこのHP内で完結させる。別ドメイン・別サイトは持たず、現行リポジトリの拡張・改変のみでポータル刷新と未実装対応を行う。

**参照**: ポータル刷新の要件整理は `docs/PORTAL_REFRESH_ANALYSIS.md`、本運用チェックリストは `PRODUCTION_CHECKLIST.md`。

---

## 1. 開発計画の全体像

| フェーズ | 内容 | 目安 |
|----------|------|------|
| **Phase 0** | 本運用前の必須技術対応（auth・DB・本番除外） | 1〜2スプリント |
| **Phase 1** | ポータル土台（ナビ・トップ・企業価値・共通文言） | 1スプリント |
| **Phase 2** | 学生向け・LP・イベント一覧・拠点情報 | 1〜2スプリント |
| **Phase 3** | 企業向け刷新・案件・Discord・有料会員の整理 | 1スプリント |
| **Phase 4** | 登録者向けメリット・団体詳細（自団体LP） | 1スプリント |
| **Phase 5** | 推奨・運用（実データ化・レート制限・問い合わせ等） | 継続 |

---

## 2. Phase 0: 本運用前の必須技術対応

本番で障害・情報漏洩を防ぐための最小セット。**本番デプロイ前に完了すること。**

### 2.1 タスク一覧

| ID | タスク | 成果物・対応内容 |
|----|--------|------------------|
| 0.1 | **users と auth の整合性** | マイグレーションの `public.users` スキーマを確認。`lib/auth.ts` の `getCurrentUser()` の select（`name`, `role`, `organization_id`）を実在カラムに合わせて修正。`create-admin.js` や他で `users` を触っている箇所も統一。 |
| 0.2 | **access_logs の扱い** | **案A**: マイグレーションで `access_logs` テーブルを作成し `logAccess()` を有効化。**案B**: 使わない場合は `logAccess()` を No-op 化またはテーブル存在時のみ insert とし、本番でエラーにしない。 |
| 0.3 | **本番でデバッグ・テストを無効化** | `app/sentry-example-page/`・`app/api/sentry-example-api/`・`app/admin/test/` を、本番（`NODE_ENV === 'production'`）では 404 またはリダイレクトする（middleware または route）。もしくはルート削除。 |
| 0.4 | **create-admin の認証情報を外だし** | `scripts/create-admin.js` のメール・パスワーを環境変数（例: `ADMIN_EMAIL`, `ADMIN_PASSWORD`）または対話入力にし、リポジトリにハードコードしない。README を更新。 |

### 2.2 完了条件

- 本番想定環境で「ログイン → 管理画面操作 → `/api/auth/check`」がエラーにならないこと。
- 上記デバッグ用URLが本番でアクセスできないこと。
- 管理者作成時に認証情報をコードから読み込んでいないこと。

---

## 3. Phase 1: ポータル土台（ナビ・トップ・企業価値）

ポータル全体のメッセージを「企業・行政への価値＝ポテンシャル人材・学生団体にすぐつながる」に揃え、学生向け・企業向けの入口を明確にする。

### 3.1 タスク一覧

| ID | タスク | 成果物・対応内容 |
|----|--------|------------------|
| 1.1 | **トップページの構成見直し** | `/` のヒーロー・リード文を「学生・学生団体とつながる」に合わせて修正。学生向け（ユニメイト・学生団体連合・イベント・拠点）と企業向けへの導線を明確に配置。 |
| 1.2 | **グローバルナビの整理** | `components/header.tsx`（およびフッター）のメニューを、以下に合わせて再構成する。学生向け: ユニメイト・学生団体連合・イベント・拠点・登録者のメリット。企業向け: サービス概要・案件・Discord・イベント委託・有料会員。About・メディア・掲示板・お知らせ・参加する・お問い合わせは維持しつつ並び・ラベルを整理。 |
| 1.3 | **企業・行政向け価値の明示** | トップまたは About／企業向けサービス冒頭に「ポテンシャル人材となる学生・学生団体にすぐつながる」を1文で掲載。必要に応じて `/services?tab=corporate` のリードにも反映。 |
| 1.4 | **学生向け入口ページの設計** | 学生向けの「玄関」を `/for-students` にまとめるか、現行 `/services?tab=student` を拡張するか方針を決め、ユニメイト紹介・学生団体連合紹介・イベント・拠点へのリンクを一元化。 |

### 3.2 成果物

- 更新済み `/`、`components/header.tsx`（および `footer.tsx` 必要に応じて）。
- 学生向け・企業向けの導線が一覧で分かる状態。

---

## 4. Phase 2: 学生向け・LP・イベント一覧・拠点情報

学生向けHPで必要な新規ページと、既存イベントAPIの公開表示を追加する。

### 4.1 新規ページ

| ID | ページ | パス（案） | 内容 |
|----|--------|------------|------|
| 2.1 | **ユニメイト紹介** | `/for-students/unimate` または `/unimate` | ユニメイトの価値・対象・できること。既存外部LP（union-match-lp.vercel.app）への CTA を置く。HP内にLPを統合する場合は同じルートを縦長LPとしても利用可能。 |
| 2.2 | **学生団体連合紹介** | `/about/union` または `/for-students/union` | 学生団体連合の紹介。既存 `/about` の内容をベースに学生団体連合に特化して再構成。 |
| 2.3 | **学生団体連合LP** | `/lp/student-union` | 縦長1ページで学生団体連合の価値・加盟メリット・CTA。必要に応じて「加盟する」など `/join/organization` へ誘導。 |
| 2.4 | **イベント一覧（公開）** | `/events` | 既存 `events` API（Supabase/Notion）を使用。学生団体イベント・UNIONイベントを一覧表示（フィルタ・タブで切り替え可能にしてもよい）。管理は既存 `/admin/events` のまま。 |
| 2.5 | **拠点情報** | `/locations` または `/about/locations` | BEGOPEN・クロスワン・その他拠点の一覧。住所・概要・「アンバサダー以外も拠点で育てる（イベント送客・就活人材・地域関係人口）」の説明を記載。 |

### 4.2 改変

| ID | 対象 | 内容 |
|----|------|------|
| 2.6 | `/api/events` または既存API | 公開用のGET（未認証で一覧取得可能）であることを確認。認証必須の場合は公開用エンドポイントを追加。 |
| 2.7 | トップ・学生向け入口 | イベント一覧・拠点情報へのリンクを追加。 |

### 4.3 成果物

- 上記 5 本の新規ページ（または統合した数）。
- 公開イベント一覧が `/events` で表示されること。

---

## 5. Phase 3: 企業向け刷新・案件・Discord・有料会員

企業向けメッセージの統一、案件の導線、Discord 説明の追加、有料会員の整理。

### 5.1 企業向けページの改変

| ID | 対象 | 内容 |
|----|------|------|
| 3.1 | `/services?tab=corporate` | 「主体的な学生をプレイヤーとして抜擢できる」を前面に。提供内容を「案件情報の登録」「Discordアクセス」「イベント委託」に整理して記載。 |
| 3.2 | `/join/corporate` | 上記に合わせて文言を統一。有料会員の特典（案件を学生に流す・Discordで学生と交流）を明記。 |
| 3.3 | **案件登録の導線** | 企業向けに「案件を登録する」導線を追加。第一段階は「お問い合わせ／フォームから案件登録依頼」とする（フォーム項目に「案件登録」を追加）。案件のCRUD・学生向け案件一覧は Phase 5 または別フェーズで検討。 |

### 5.2 Discord 対応

| ID | タスク | 内容 |
|----|--------|------|
| 3.4 | **Discord 説明ブロックの追加** | 学生向け・企業向けの両方で、Discordの役割（登録情報の閲覧・コミュニケーション）を説明する文言を追加。Discord招待リンクは環境変数で管理（例: `NEXT_PUBLIC_DISCORD_INVITE_URL`）。 |
| 3.5 | **Slack と Discord の併記または移行** | 完全にDiscordへ移行する場合は、`community/slack` を `community/discord` に変更するか、Slack を「従来」・Discord を「現在」として併記。ヘッダー・フッター・コミュニティ内のリンクを一括置換。 |

### 5.3 有料会員企業の整理

| ID | タスク | 内容 |
|----|--------|------|
| 3.6 | **有料会員の特典を明文化** | サービス／参加方法ページに「有料会員となった企業が得られること：案件情報を学生に流せる・Discordで学生と交流できる」をセクションとして追加。料金表（既存）との対応を明確にする。 |

### 5.4 成果物

- 更新済み `/services`（企業タブ）・`/join/corporate`。
- Discord 説明とリンクの追加、必要に応じて Slack→Discord の文言・ルート整理。
- 案件登録につなげるフォームまたは問い合わせ導線。

---

## 6. Phase 4: 登録者向けメリット・団体詳細（自団体LP）

「登録している学生個人」「登録している学生団体」が得られることを明示し、団体詳細をLP的に使えるようにする。

### 6.1 新規ページ

| ID | ページ | パス（案） | 内容 |
|----|--------|------------|------|
| 4.1 | **登録学生のメリット** | `/for-students/benefits` | 登録学生個人が得られるもの：個人向け案件・イベント情報・Discordリンク。ログイン後ダッシュボードを将来作る場合はその入口もここに記載。 |
| 4.2 | **登録学生団体のメリット** | `/for-organizations/benefits` | 登録学生団体が得られるもの：自団体LP・団体向け案件・学生団体基礎知識・Discord（代表）。 portal や団体詳細への導線を配置。 |
| 4.3 | **学生団体基礎知識** | `/for-organizations/basics` または `/about/student-org-basics` | 学生団体の基礎知識コンテンツ。必要に応じて固定ページまたはニュース/Notion連携で運用。 |

### 6.2 団体詳細（自団体LP）の強化

| ID | タスク | 内容 |
|----|--------|------|
| 4.4 | **団体詳細ページの新設** | `/community/organizations/[id]` または `/org/[slug]` を新規作成。加盟団体を1団体ごとに表示し、「自団体のLP」として共有できるようにする。既存の `organizations` API または admin で管理している団体データを参照。 |
| 4.5 | **一覧からの導線** | `/community/organizations` の一覧から各団体の詳細ページへリンク。 |

### 6.3 成果物

- `/for-students/benefits`、`/for-organizations/benefits`。
- 学生団体基礎知識ページ（1本）。
- 団体詳細ページ（動的ルート）と一覧からのリンク。

---

## 7. Phase 5: 推奨・運用・オプション

本運用直前〜運用開始後に実施する推奨項目と、オプション機能。

### 7.1 本運用前〜直後の推奨

| ID | タスク | 内容 |
|----|--------|------|
| 5.1 | **レート制限の拡大** | 公開API（news, events, members, supporters, organizations, partners の GET）に `lib/rate-limiter.ts` の `checkRateLimit` を適用。必要に応じて管理APIの入口にも適用。 |
| 5.2 | **テストデータAPIの無効化** | `app/api/admin/*/test-data/` を本番では 403 にする（環境変数でフラグ制御）。または「本番では呼ばない」ことをドキュメントで明記。 |
| 5.3 | **CI と package.json の統一** | Node・pnpm のバージョンを CI と `package.json` の `engines` で一致させる。 |
| 5.4 | **join / community の実データ化** | `app/join/page.tsx` の「連携コミュニティ」、`app/community/page.tsx` のタブ内団体・提携企業一覧を、API/DB（organizations, partners）から取得するように変更。モックデータを削除。 |

### 7.2 オプション・継続

| ID | タスク | 内容 |
|----|--------|------|
| 5.5 | **お問い合わせフォーム** | サイト内フォーム＋API（バリデーション＋Resend等で送信）。現在は外部Notionフォーム・mailto のみ。要件が決まり次第設計・実装。 |
| 5.6 | **案件のCRUDと学生向け一覧** | 企業が案件を登録し、学生が一覧・応募する機能。テーブル設計・管理画面・公開API・公開ページの追加が必要。必要に応じて別フェーズで詳細化。 |
| 5.7 | **ユニメイトLPのHP内統合** | 現状は外部 `union-match-lp.vercel.app` へのリンク。このHPに統合する場合は `/lp/unimate` 等で縦長LPを実装し、リンクを差し替え。 |
| 5.8 | **E2E・結合テスト** | 管理画面の主要フロー・認証の E2E を追加。 |
| 5.9 | **バックアップ・運用手順** | バックアップ取得のタイミング・範囲を `PRODUCTION_CHECKLIST.md` に記載。必要ならスクリプト・Cron で自動化。 |
| 5.10 | **sitemap の拡張** | `app/sitemap.ts` に、追加した `/events`・`/locations`・`/for-students/*`・`/for-organizations/*`・`/lp/*` 等を反映。 |

---

## 8. マスタートスク・チェックリスト

実装・確認時にチェックする一覧。Phase 順。

### Phase 0: 必須技術
- [x] 0.1 users と auth の整合性
- [x] 0.2 access_logs の扱い
- [x] 0.3 本番でデバッグ・テスト用を無効化
- [x] 0.4 create-admin の認証情報を外だし

### Phase 1: ポータル土台
- [x] 1.1 トップページの構成見直し
- [x] 1.2 グローバルナビの整理
- [x] 1.3 企業・行政向け価値の明示
- [x] 1.4 学生向け入口の設計

### Phase 2: 学生向け・LP・イベント・拠点
- [x] 2.1 ユニメイト紹介ページ
- [x] 2.2 学生団体連合紹介ページ
- [x] 2.3 学生団体連合LP
- [x] 2.4 イベント一覧（公開）
- [x] 2.5 拠点情報ページ
- [x] 2.6 イベント公開APIの確認
- [x] 2.7 トップ・学生向けからの導線追加

### Phase 3: 企業向け・案件・Discord・有料会員
- [x] 3.1 企業向けサービスページの刷新
- [x] 3.2 join/corporate の整理
- [x] 3.3 案件登録の導線（フォーム等）
- [x] 3.4 Discord 説明ブロック追加
- [x] 3.5 Slack / Discord の併記または移行
- [x] 3.6 有料会員の特典を明文化

### Phase 4: 登録者向け・団体詳細
- [x] 4.1 登録学生のメリットページ
- [x] 4.2 登録学生団体のメリットページ
- [ ] 4.3 学生団体基礎知識ページ（コンテンツは将来追加可）
- [x] 4.4 団体詳細ページ（自団体LP）
- [x] 4.5 一覧から団体詳細へのリンク

### Phase 5: 推奨・オプション
- [x] 5.1 レート制限の拡大
- [x] 5.2 テストデータAPIの無効化
- [ ] 5.3 CI と package.json の統一
- [ ] 5.4 join / community の実データ化
- [ ] 5.5 お問い合わせフォーム（オプション）
- [ ] 5.6 案件CRUD・学生向け一覧（オプション）
- [ ] 5.7 ユニメイトLPのHP内統合（オプション）
- [ ] 5.8 E2E テスト（オプション）
- [ ] 5.9 バックアップ・運用手順
- [x] 5.10 sitemap の拡張

---

## 9. 想定URLマップ（刷新後）

| 種別 | パス | 備考 |
|------|------|------|
| トップ | `/` | 学生・企業価値を明示 |
| 学生向け | `/for-students` または `/services?tab=student` | 入口 |
| ユニメイト紹介 | `/for-students/unimate` または `/unimate` | 新規 |
| 学生団体連合紹介 | `/about/union` または `/for-students/union` | 新規 |
| 学生団体連合LP | `/lp/student-union` | 新規 |
| 登録学生のメリット | `/for-students/benefits` | 新規 |
| 登録団体のメリット | `/for-organizations/benefits` | 新規 |
| 学生団体基礎知識 | `/for-organizations/basics` 等 | 新規 |
| イベント一覧 | `/events` | 新規 |
| 拠点情報 | `/locations` または `/about/locations` | 新規 |
| 団体詳細（自団体LP） | `/community/organizations/[id]` 等 | 新規 |
| 企業向け | `/services?tab=corporate` | 改変 |
| 参加（企業） | `/join/corporate` | 改変 |
| コミュニケーション | `/community/discord` または `/community/slack` | 追加・移行 |
| 既存維持 | `/about`, `/news`, `/board`, `/community`, `/join`, `/contact`, `/media` 等 | 文言・ナビのみ調整 |

---

## 10. 進め方の目安

- **優先順**: Phase 0 → Phase 1 → Phase 2 → Phase 3 → Phase 4 → Phase 5。
- **Phase 0** は本番デプロイ前に必須。**Phase 1〜4** でポータル刷新をHP内完結で実現。**Phase 5** は余裕に応じて実施。
- 各タスクは「仕様メモ → 実装 → 動作確認（必要ならテスト）」の順で進めると安全。
- スキーマ変更（案件テーブルなど）を行う場合は、既存本番データの有無を確認し、ロールバック手順を用意する。

---

## 11. 更新履歴

| 日付 | 内容 |
|------|------|
| 2025年1月 | 初版（本運用前の技術対応をフェーズ1として記載）。 |
| 2025年1月 | ポータル刷新・未実装を統合した全体開発計画に差し替え。Phase 0〜5 とマスターチェックリストを追加。 |
