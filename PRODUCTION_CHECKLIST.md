# UNION HP 本運用チェックリスト

## ✅ 事前準備

### 環境設定
- [x] 環境変数の設定完了
- [x] Supabaseプロジェクトの作成
- [x] データベーススキーマの適用
- [x] Storageバケットの設定
- [x] 初期管理者ユーザーの作成

### 開発環境
- [x] 依存関係のインストール完了
- [x] ビルドテスト成功
- [x] 開発サーバー正常動作
- [x] 認証システム動作確認

## 🔧 本番環境デプロイ

### Vercel設定
- [ ] Vercelプロジェクトの作成
- [ ] 環境変数の設定
- [ ] ドメインの設定
- [ ] SSL証明書の有効化

### 監視・分析
- [x] Sentry監視の設定
- [ ] Google Analytics 4の設定
- [ ] Google Search Consoleの登録
- [ ] エラーアラートの設定

## 🚀 デプロイ実行

### 自動デプロイ
```bash
# デプロイスクリプト実行
./scripts/deploy.sh
```

### 手動デプロイ
1. Vercelダッシュボードでプロジェクトをインポート
2. 環境変数を設定
3. デプロイ実行

## 📋 デプロイ後確認

### 基本動作
- [ ] トップページの表示
- [ ] 管理画面へのアクセス
- [ ] 認証システムの動作
- [ ] 画像アップロード機能

### 機能確認
- [x] ニュース管理機能
- [x] イベント管理機能
- [x] 掲示板管理機能
- [x] 加盟団体管理機能
- [x] 提携団体管理機能
- [x] 運営メンバー管理機能

### パフォーマンス
- [x] ページ読み込み速度
- [x] 画像最適化
- [x] モバイル対応
- [x] SEO設定

### セキュリティ
- [x] HTTPS接続
- [x] セキュリティヘッダー
- [x] 認証・認可
- [x] データ保護

## 🔍 運用監視

### 日常監視
- [ ] エラーログの確認
- [ ] パフォーマンス監視
- [ ] アクセス解析
- [ ] セキュリティ監視

### 定期メンテナンス
- [ ] 依存関係の更新
- [ ] セキュリティパッチの適用
- [ ] データベースの最適化
- [ ] バックアップの確認

## 💾 バックアップ・運用手順

### バックアップの取得

#### 推奨タイミング
- **定期**: 週次または重要リリード前に実施
- **事前**: 大規模なデータマイグレーション・スキーマ変更の前
- **事後**: 一括データ投入や管理画面からの一括操作の後

#### 対象範囲
| 対象 | 方法 |
|------|------|
| **Supabase データベース** | Supabase Dashboard → Project Settings → Database → Backup から日次スナップショットを確認。手動エクスポートが必要な場合は Dashboard の SQL Editor で `pg_dump` 相当のエクスポートや、Supabase CLI の `db dump` を利用。 |
| **Storage（画像・ファイル）** | Supabase Dashboard → Storage で各バケットのファイル一覧を確認。重要ファイルは定期的に別ストレージ（S3 等）やローカルへコピーを検討。 |
| **環境変数** | Vercel 等のダッシュボードで環境変数をエクスポートまたは一覧を別ドキュメントに控えておく（機密情報は厳重に管理）。 |
| **コード** | Git でタグ・ブランチを運用し、本番デプロイごとにタグを打つなどして復元ポイントを明確にする。 |

#### 手順（Supabase DB の論理バックアップ例）
1. Supabase プロジェクトにログイン
2. **Database** → **Backups** で自動バックアップの有無・保持期間を確認
3. 手動でダンプが必要な場合: 接続文字列を使ってローカルで `pg_dump` を実行するか、Supabase の「Backup now」や「Point in Time Recovery」の利用可否を確認
4. ダンプファイルは暗号化して安全な場所に保管（例: パスワード付きZIP + 別ストレージ）

#### 復元の流れ
1. 障害内容の特定（テーブル単位か、全DBか）
2. バックアップから該当データをリストア（Supabase の PITR または手動リストア）
3. アプリ側のキャッシュ・環境変数の見直し
4. 動作確認後、監視を継続

### 運用メモ
- 本番 DB への直接 SQL 実行は原則避け、マイグレーション（`supabase/migrations/`）で管理する
- 管理者アカウントの追加は `node scripts/create-admin.js` を利用し、認証情報をコードに含めない

## 📞 緊急時対応

### 障害発生時
1. エラーログの確認
2. 影響範囲の特定
3. 一時的な対応
4. 根本原因の調査
5. 恒久的な対策

### 連絡先
- 開発チーム: [連絡先]
- 運用チーム: [連絡先]
- 緊急時: [緊急連絡先]

## 🎯 成功指標

### 技術指標
- [x] ページ読み込み時間 < 3秒
- [ ] エラー率 < 1%
- [ ] 稼働率 > 99.9%
- [ ] セキュリティインシデント 0件

### 運用指標
- [ ] 管理画面の利用状況
- [ ] コンテンツ更新頻度
- [ ] ユーザー満足度
- [ ] 運用効率の向上

## ✅ 修正完了項目

### 技術的修正
- [x] 不足していたファイルの作成（use-admin-auth-simple.tsx, supabase/server.ts）
- [x] 認証フックの統一
- [x] ビルドエラーの修正
- [x] 構文エラーの修正
- [x] React Hooks使用規則の修正（条件付き呼び出しを修正）

### 本運用準備
- [x] 管理者アカウント作成スクリプト
- [x] デプロイスクリプトの更新
- [x] 環境変数テンプレートの更新
- [x] 本運用チェックリストの更新

### 現在の状況
- [x] ビルド成功（97ページ）
- [x] 全機能実装完了
- [x] 認証システム動作確認
- [x] 管理画面全機能動作確認
- [x] セキュリティ設定完了
- [x] 監視システム統合完了

## 📌 本運用前に実施すべき技術項目（詳細は DEVELOPMENT_PLAN.md）

開発計画で洗い出した「必須対応」（**Phase 0**）は本番デプロイ前に実施することを推奨します。

- [ ] **users と auth の整合性** - `public.users` のスキーマと `lib/auth.ts` の参照を一致させる
- [ ] **access_logs** - テーブル作成するか、`logAccess` を本番でも安全に動作させる
- [ ] **デバッグ・テスト用の無効化** - `sentry-example-page` / `sentry-example-api` / `admin/test` を本番でアクセス不可にする
- [ ] **create-admin の認証情報** - メール・パスワードを環境変数または対話入力に移す（ハードコード削除）

→ 上記は **Phase 0**。ポータル刷新・追加コンテンツ・推奨タスクを含む全体の開発計画は **[DEVELOPMENT_PLAN.md](./DEVELOPMENT_PLAN.md)**（Phase 0〜5）を参照してください。

## 🚀 本運用開始準備完了

**上記の技術項目を確認のうえ、本運用を開始してください。**

### 次のステップ:
1. **開発計画の実施** - `DEVELOPMENT_PLAN.md` のフェーズ1（必須対応）を完了する
2. **環境変数の設定** - `env.example`を参考に`.env.local`を作成
3. **管理者アカウントの作成** - `node scripts/create-admin.js`を実行（認証情報はコードに含めない）
4. **Vercelデプロイ** - `./scripts/deploy.sh`を実行
5. **ドメイン設定** - Vercelダッシュボードでドメインを設定
6. **監視設定** - Sentry、Google Analytics等の設定

---

**最終更新**: 2025年1月
**バージョン**: v1.2.0
**担当者**: 開発チーム 